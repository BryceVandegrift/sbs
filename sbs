#!/bin/sh

# Static Blogging System: A blog generation script
# 2021 Bryce Vandegrift
# This program is licensed under the GPL V3
# Report bugs to: bpv@disroot.org

name="Bryce Vandegrift"
website="https://brycevandegrift.xyz/"
website_dir="/home/bryce/Documents/website"
blog_dir="blog"
blogindex="blog/index.html"
rssindex="rss.xml"
draft_dir=".drafts"

default() {
	[ -z "$1" ] && help || echo "ERROR: $1 is not a valid command!" && exit 1
}

listDrafts() {
	echo "Printing drafts"
	case "$(ls "$website_dir/$draft_dir" | wc -l)" in
		0) echo "There are no drafts." && exit 1 ;;
		*) ls -rc "$website_dir/$draft_dir" | nl
		read -rp "Pick a draft to $1: " number ;;
	esac
}

new() {
	read -rp "Enter file name: " name
	echo $name | grep -q "\"" && echo "Double quotes are not allowed in file names." && exit 1
	url="$(echo $name | tr -d '[:punct:]' | tr ' ' '-' | tr '[:upper:]' '[:lower:]')"
	( [ -f "$website_dir/$draft_dir/$url.md" ] || [ -f "$website_dir/$blog_dir/$url.html" ] ) && echo "A draft or post already exists under that name!" && exit 1
	$EDITOR "$website_dir/.drafts/$url.md"
}

edit() {
	echo "Editing..."
}

publish() {
	echo "Draft is published..."
}

delete() {
	echo "Deleting draft"
}

help() {
	cat <<-EOF
Usage:
        sbs [OPERATION] ...
Operations:
        sbs new
        sbs edit
	sbs publish
	sbs delete
        sbs help
                Show this text
        sbs version
                Show program version
EOF
}

version() {
	echo "sbs: Static Blogging System V1.0.0"
}

[ -z "$EDITOR" ] && EDITOR="vi"

case "$1" in
	new) shift;	new "$@" ;;
	edit) shift;	edit "$@" ;;
	publish) shift;		publish "$@" ;;
	delete|del) shift;	delete "$@" ;;
	help|-h) shift;	help "$@" ;;
	version|-v) shift;	version "$@" ;;
	*)	default "$@" ;;
esac
exit 0
